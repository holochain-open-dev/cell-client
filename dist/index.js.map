{"version":3,"file":"index.js","sources":["../src/holo-client.ts","../src/holochain-client.ts"],"sourcesContent":["import { CellClient } from \"./cell-client\";\n\nimport { AppSignalCb, InstalledCell } from \"@holochain/conductor-api\";\nimport * as HoloSdk from \"@holo-host/web-sdk\";\n\nexport class HoloClient implements CellClient {\n  constructor(\n    protected connection: any,\n    protected cellData: InstalledCell,\n    protected branding: HoloSdk.Branding\n  ) {}\n\n  get cellId() {\n    return this.cellData.cell_id;\n  }\n\n  async callZome(zomeName: string, fnName: string, payload: any): Promise<any> {\n    const result = await this.connection.zomeCall(\n      this.cellData.cell_nick,\n      zomeName,\n      fnName,\n      payload\n    );\n\n    if (result && result.type === \"error\") {\n      throw new Error(result.payload.message);\n    }\n    return result;\n  }\n\n  async addSignalHandler(signalHandler: AppSignalCb) {\n    new HoloSdk.Connection(\n      this.connection.chaperone_url.origin,\n      signalHandler,\n      this.branding\n    );\n\n    return {\n      unsubscribe: () => {\n        // TODO: disconnect connection\n      },\n    };\n  }\n}\n","import {\n  AppWebsocket,\n  InstalledCell,\n  AppSignalCb,\n} from \"@holochain/conductor-api\";\nimport { CellClient } from \"./cell-client\";\n\nexport class HolochainClient implements CellClient {\n  constructor(\n    protected appWebsocket: AppWebsocket,\n    protected cellData: InstalledCell\n  ) {}\n\n  get cellId() {\n    return this.cellData.cell_id;\n  }\n\n  callZome(zomeName: string, fnName: string, payload: any): Promise<any> {\n    return this.appWebsocket.callZome({\n      cap: null as any,\n      cell_id: this.cellId,\n      zome_name: zomeName,\n      fn_name: fnName,\n      payload: payload,\n      provenance: this.cellId[1],\n    });\n  }\n\n  async addSignalHandler(signalHandler: AppSignalCb) {\n    const appWs = await AppWebsocket.connect(\n      this.appWebsocket.client.socket.url,\n      15000,\n      signalHandler\n    );\n\n    return {\n      unsubscribe: () => {\n        appWs.client.close();\n      },\n    };\n  }\n}\n"],"names":[],"mappings":";;;MAKa,UAAU;IACrB,YACY,UAAe,EACf,QAAuB,EACvB,QAA0B;QAF1B,eAAU,GAAV,UAAU,CAAK;QACf,aAAQ,GAAR,QAAQ,CAAe;QACvB,aAAQ,GAAR,QAAQ,CAAkB;KAClC;IAEJ,IAAI,MAAM;QACR,OAAO,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC;KAC9B;IAED,MAAM,QAAQ,CAAC,QAAgB,EAAE,MAAc,EAAE,OAAY;QAC3D,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,QAAQ,CAC3C,IAAI,CAAC,QAAQ,CAAC,SAAS,EACvB,QAAQ,EACR,MAAM,EACN,OAAO,CACR,CAAC;QAEF,IAAI,MAAM,IAAI,MAAM,CAAC,IAAI,KAAK,OAAO,EAAE;YACrC,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;SACzC;QACD,OAAO,MAAM,CAAC;KACf;IAED,MAAM,gBAAgB,CAAC,aAA0B;QAC/C,IAAI,OAAO,CAAC,UAAU,CACpB,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,MAAM,EACpC,aAAa,EACb,IAAI,CAAC,QAAQ,CACd,CAAC;QAEF,OAAO;YACL,WAAW,EAAE;;aAEZ;SACF,CAAC;KACH;;;MCnCU,eAAe;IAC1B,YACY,YAA0B,EAC1B,QAAuB;QADvB,iBAAY,GAAZ,YAAY,CAAc;QAC1B,aAAQ,GAAR,QAAQ,CAAe;KAC/B;IAEJ,IAAI,MAAM;QACR,OAAO,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC;KAC9B;IAED,QAAQ,CAAC,QAAgB,EAAE,MAAc,EAAE,OAAY;QACrD,OAAO,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC;YAChC,GAAG,EAAE,IAAW;YAChB,OAAO,EAAE,IAAI,CAAC,MAAM;YACpB,SAAS,EAAE,QAAQ;YACnB,OAAO,EAAE,MAAM;YACf,OAAO,EAAE,OAAO;YAChB,UAAU,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;SAC3B,CAAC,CAAC;KACJ;IAED,MAAM,gBAAgB,CAAC,aAA0B;QAC/C,MAAM,KAAK,GAAG,MAAM,YAAY,CAAC,OAAO,CACtC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,EACnC,KAAK,EACL,aAAa,CACd,CAAC;QAEF,OAAO;YACL,WAAW,EAAE;gBACX,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;aACtB;SACF,CAAC;KACH;;;;;"}