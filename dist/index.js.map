{"version":3,"file":"index.js","sources":["../src/base-client.ts","../src/holo-client.ts","../src/holochain-client.ts"],"sourcesContent":["import { CellClient } from \"./cell-client\";\n\nimport { AppSignalCb, InstalledCell } from \"@holochain/conductor-api\";\n\nexport abstract class BaseClient {\n  protected handlers: Array<AppSignalCb> = [];\n\n  async addSignalHandler(signalHandler: AppSignalCb) {\n    this.handlers.push(signalHandler);\n\n    return {\n      unsubscribe: () => {\n        const index = this.handlers.findIndex((h) => h === signalHandler);\n        this.handlers.splice(index, 1);\n      },\n    };\n  }\n\n  protected handleSignal(signal: any) {\n    for (const handler of this.handlers) {\n      handler(signal);\n    }\n  }\n}\n","import { CellClient } from \"./cell-client\";\n\nimport { InstalledCell } from \"@holochain/conductor-api\";\nimport { BaseClient } from \"./base-client\";\n\nexport class HoloClient extends BaseClient implements CellClient {\n  constructor(\n    protected connection: any,\n    protected cellData: InstalledCell,\n    protected branding: any\n  ) {\n    super();\n    this.handlers.push(this.connection.signalCb);\n    this.connection.signalCb = (s: any) => this.handleSignal(s);\n  }\n\n  get cellId() {\n    return this.cellData.cell_id;\n  }\n\n  async callZome(zomeName: string, fnName: string, payload: any): Promise<any> {\n    const result = await this.connection.zomeCall(\n      this.cellData.role_id,\n      zomeName,\n      fnName,\n      payload\n    );\n\n    if (result && result.type === \"error\") {\n      throw new Error(result.payload.message);\n    }\n    return result;\n  }\n}\n","import { AppWebsocket, InstalledCell } from \"@holochain/conductor-api\";\nimport { BaseClient } from \"./base-client\";\nimport { CellClient } from \"./cell-client\";\n\nexport class HolochainClient extends BaseClient implements CellClient {\n  constructor(\n    protected appWebsocket: AppWebsocket,\n    protected cellData: InstalledCell\n  ) {\n    super();\n    AppWebsocket.connect(this.appWebsocket.client.socket.url, 15000, (s) =>\n      this.handleSignal(s)\n    );\n  }\n\n  get cellId() {\n    return this.cellData.cell_id;\n  }\n\n  callZome(\n    zomeName: string,\n    fnName: string,\n    payload: any,\n    timeout = 15000\n  ): Promise<any> {\n    return this.appWebsocket.callZome(\n      {\n        cap: null as any,\n        cell_id: this.cellId,\n        zome_name: zomeName,\n        fn_name: fnName,\n        payload: payload,\n        provenance: this.cellId[1],\n      },\n      timeout\n    );\n  }\n}\n"],"names":[],"mappings":";;MAIsB,UAAU;IAAhC;QACY,aAAQ,GAAuB,EAAE,CAAC;KAkB7C;IAhBC,MAAM,gBAAgB,CAAC,aAA0B;QAC/C,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAElC,OAAO;YACL,WAAW,EAAE;gBACX,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,aAAa,CAAC,CAAC;gBAClE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;aAChC;SACF,CAAC;KACH;IAES,YAAY,CAAC,MAAW;QAChC,KAAK,MAAM,OAAO,IAAI,IAAI,CAAC,QAAQ,EAAE;YACnC,OAAO,CAAC,MAAM,CAAC,CAAC;SACjB;KACF;;;MCjBU,UAAW,SAAQ,UAAU;IACxC,YACY,UAAe,EACf,QAAuB,EACvB,QAAa;QAEvB,KAAK,EAAE,CAAC;QAJE,eAAU,GAAV,UAAU,CAAK;QACf,aAAQ,GAAR,QAAQ,CAAe;QACvB,aAAQ,GAAR,QAAQ,CAAK;QAGvB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QAC7C,IAAI,CAAC,UAAU,CAAC,QAAQ,GAAG,CAAC,CAAM,KAAK,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;KAC7D;IAED,IAAI,MAAM;QACR,OAAO,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC;KAC9B;IAED,MAAM,QAAQ,CAAC,QAAgB,EAAE,MAAc,EAAE,OAAY;QAC3D,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,QAAQ,CAC3C,IAAI,CAAC,QAAQ,CAAC,OAAO,EACrB,QAAQ,EACR,MAAM,EACN,OAAO,CACR,CAAC;QAEF,IAAI,MAAM,IAAI,MAAM,CAAC,IAAI,KAAK,OAAO,EAAE;YACrC,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;SACzC;QACD,OAAO,MAAM,CAAC;KACf;;;MC5BU,eAAgB,SAAQ,UAAU;IAC7C,YACY,YAA0B,EAC1B,QAAuB;QAEjC,KAAK,EAAE,CAAC;QAHE,iBAAY,GAAZ,YAAY,CAAc;QAC1B,aAAQ,GAAR,QAAQ,CAAe;QAGjC,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,KAAK,EAAE,CAAC,CAAC,KACjE,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CACrB,CAAC;KACH;IAED,IAAI,MAAM;QACR,OAAO,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC;KAC9B;IAED,QAAQ,CACN,QAAgB,EAChB,MAAc,EACd,OAAY,EACZ,OAAO,GAAG,KAAK;QAEf,OAAO,IAAI,CAAC,YAAY,CAAC,QAAQ,CAC/B;YACE,GAAG,EAAE,IAAW;YAChB,OAAO,EAAE,IAAI,CAAC,MAAM;YACpB,SAAS,EAAE,QAAQ;YACnB,OAAO,EAAE,MAAM;YACf,OAAO,EAAE,OAAO;YAChB,UAAU,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;SAC3B,EACD,OAAO,CACR,CAAC;KACH;;;;;"}